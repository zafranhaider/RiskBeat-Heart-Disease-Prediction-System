{% extends 'index.html' %}
{% load static %}

{% block body %}
<style>
  /* Global body style */
  body {
    height: auto;
    min-height: 100vh;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #1e90ff 50%, #87cefa 75%, #e0f7fa 100%);
    background-attachment: fixed;
}

  /* Container styles */
  .container2 {
    max-width: 900px;
    border-radius: 10px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    background: white; /* Ensure form has a different background */
    padding: 20px;
    margin: 50px auto;
  }

  /* Headings */
  h2 {
    text-align: center;
    margin-bottom: 30px;
    color: #333;
  }

  h3 {
    text-align: center;
    margin-bottom: 20px;
    color: #444;
  }

  /* Form wrapper */
  .form-wrapper {
    background: #fff; /* Separate form background */
    padding: 20px;
    border-radius: 10px;
  }

  /* Form styles */
  form {
    width: 100%;
  }

  label {
    display: block;
    margin: 15px 0 5px;
    font-weight: 600;
    color: #555;
  }

  input, select {
    width: 100%;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-bottom: 15px;
    font-size: 15px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }

  input:focus, select:focus {
    border-color: #4CAF50;
    box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
    outline: none;
  }

  /* Button styles */
  button {
    width: 100%;
    background-color: #4CAF50;
    color: #fff;
    padding: 14px;
    border: none;
    border-radius: 6px;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-top: 10px;
  }

  button:hover {
    background-color: #45a049;
  }

  /* Prediction box */
  .prediction-box {
    background: #4a8dff;
    color: #fff;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    max-width: 400px;
    margin: 20px auto;
  }

  .prediction-text {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 0;
    color: #3e4586;
  }
</style>
</head>
<body>
  <div class="container2">
    
      {% if prediction is not None %}
          {% if prediction == "Risk of Heart Disease" %}
              <div class="alert alert-danger mt-4" role="alert"> <!-- Red for high risk -->
          {% else %}
              <div class="alert alert-success mt-4" role="alert"> <!-- Green for low risk -->
          {% endif %}
              <h4 class="alert-heading" style="text-align: center;">Prediction Result:</h4>
              <p style="text-align: center;">{{ prediction }}</p>
              <p style="text-align: center; font-weight: bold;">Model Accuracy: 74%</p>
          </div>
      {% endif %}

  
    <h2 class="text-center">Cardio Vas-Disease Prediction</h2>
    <form id="healthForm" method="POST" onsubmit="return validateForm()" class="mt-4">
      {% csrf_token %}
  
      <div class="mb-3">
          <label for="age" class="form-label">Age:</label>
          <input type="number" class="form-control" id="age" name="age" placeholder="Enter your age (29-64)" required>
          <small class="text-danger" id="ageError"></small>
      </div>
  
      <div class="mb-3">
          <label for="gender" class="form-label">Gender (1=Female, 2=Male):</label>
          <input type="number" class="form-control" id="gender" name="gender" placeholder="1 for Female, 2 for Male" required>
          <small class="text-danger" id="genderError"></small>
      </div>
  
      <div class="mb-3">
          <label for="height" class="form-label">Height (cm):</label>
          <input type="number" class="form-control" id="height" name="height" placeholder="Enter your height (100-250 cm)" required>
          <small class="text-danger" id="heightError"></small>
      </div>
  
      <div class="mb-3">
          <label for="weight" class="form-label">Weight (kg):</label>
          <input type="number" class="form-control" id="weight" name="weight" placeholder="Enter your weight (30-200 kg)" required>
          <small class="text-danger" id="weightError"></small>
      </div>
  
      <div class="mb-3">
          <label for="ap_hi" class="form-label">Systolic BP (ap_hi):</label>
          <input type="number" class="form-control" id="ap_hi" name="ap_hi" placeholder="e.g., 120 (60-240)" required>
          <small class="text-danger" id="ap_hiError"></small>
      </div>
  
      <div class="mb-3">
          <label for="ap_lo" class="form-label">Diastolic BP (ap_lo):</label>
          <input type="number" class="form-control" id="ap_lo" name="ap_lo" placeholder="e.g., 80 (40-182)" required>
          <small class="text-danger" id="ap_loError"></small>
      </div>
  
      <div class="mb-3">
          <label for="cholesterol" class="form-label">Cholesterol (1-3):</label>
          <input type="number" class="form-control" id="cholesterol" name="cholesterol" placeholder="1=Normal, 2=Above Normal, 3=High" required>
          <small class="text-danger" id="cholesterolError"></small>
      </div>
  
      <div class="mb-3">
          <label for="gluc" class="form-label">Glucose (1-3):</label>
          <input type="number" class="form-control" id="gluc" name="gluc" placeholder="1=Normal, 2=Above Normal, 3=High" required>
          <small class="text-danger" id="glucError"></small>
      </div>
  
      <div class="mb-3">
          <label for="smoke" class="form-label">Smoking (0=No, 1=Yes):</label>
          <input type="number" class="form-control" id="smoke" name="smoke" placeholder="0 for No, 1 for Yes" required>
          <small class="text-danger" id="smokeError"></small>
      </div>
  
      <div class="mb-3">
          <label for="alco" class="form-label">Alcohol (0=No, 1=Yes):</label>
          <input type="number" class="form-control" id="alco" name="alco" placeholder="0 for No, 1 for Yes" required>
          <small class="text-danger" id="alcoError"></small>
      </div>
  
      <div class="mb-3">
          <label for="active" class="form-label">Physical Activity (0=No, 1=Yes):</label>
          <input type="number" class="form-control" id="active" name="active" placeholder="0 for No, 1 for Yes" required>
          <small class="text-danger" id="activeError"></small>
      </div>
  
      <button type="submit" class="btn btn-primary w-100">Predict</button>
  </form>
  
  <!-- âœ… Autofill from localStorage -->
  <script>
  document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('healthForm');
  
      // Autofill all saved values
   // Autofill existing values from localStorage (excluding csrf)
   for (let field of form.elements) {
        if (field.name && field.name !== 'csrfmiddlewaretoken' && localStorage.getItem(field.name)) {
            field.value = localStorage.getItem(field.name);
        }
    }

    // Save new values on input/select change (excluding csrf)
    form.addEventListener('input', function () {
        for (let field of form.elements) {
            if (field.name && field.name !== 'csrfmiddlewaretoken') {
                localStorage.setItem(field.name, field.value);
            }
        }
    });
});
  </script>
  
  <script>
      function validateForm() {
          let isValid = true;
          
          function validateField(id, min, max, errorMsg) {
              let field = document.getElementById(id);
              let errorElement = document.getElementById(id + "Error");
              let value = parseFloat(field.value);
              
              if (isNaN(value) || value < min || value > max) {
                  errorElement.textContent = errorMsg;
                  field.classList.add("is-invalid");
                  isValid = false;
              } else {
                  errorElement.textContent = "";
                  field.classList.remove("is-invalid");
              }
          }

          validateField("age", 29, 64, "Age must be between 29 and 64.");
          validateField("gender", 1, 2, "Gender must be 1 (Female) or 2 (Male).");
          validateField("height", 100, 250, "Height must be between 100 cm and 250 cm.");
          validateField("weight", 30, 200, "Weight must be between 30 kg and 200 kg.");
          validateField("ap_hi", 60, 240, "Systolic BP must be between 60 and 240.");
          validateField("ap_lo", 40, 182, "Diastolic BP must be between 40 and 182.");
          validateField("cholesterol", 1, 3, "Cholesterol must be 1, 2, or 3.");
          validateField("gluc", 1, 3, "Glucose must be 1, 2, or 3.");
          validateField("smoke", 0, 1, "Smoking must be 0 (No) or 1 (Yes).");
          validateField("alco", 0, 1, "Alcohol must be 0 (No) or 1 (Yes).");
          validateField("active", 0, 1, "Physical activity must be 0 (No) or 1 (Yes).");

          return isValid;
      }
  </script>

  <style>
      .is-invalid {
          border-color: red;
      }
      .text-danger {
          font-size: 0.9em;
      }
  </style>
  </div>
  
  <!-- jQuery and Bootstrap Bundle (includes Popper) -->
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
</body>
</html>
{% endblock %}
